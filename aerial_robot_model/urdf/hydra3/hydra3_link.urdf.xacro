<?xml version="1.0"?>
<robot
    xmlns:xacro="http://www.ros.org/wiki/xacro" name="hydra_link" >

  <!-- problem: the direction of the link is opposite, because the joint!! -->
  <xacro:macro name="hydra3_link" params="self child head tail imu"> 

    <xacro:if value="${head}">  
      <link name="link${self}">
        <collision>
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <geometry>
          <cylinder length="0.1" radius="${protector_radius}"/>
          </geometry>
        </collision>

        <visual>
          <origin rpy="0 0 ${pi}" xyz="0 0 0"/>
          <geometry>
            <mesh filename="package://aerial_robot_model/urdf/hydra3/mesh/hydra_link1.stl" scale=".001 .001 .001"/>
          </geometry>
          <xacro:link_color /> 
        </visual>

        <inertial>
          <origin xyz="0 0 0" rpy="0 0 0"/>
          <mass value="0.5"/>
          <inertia
	      ixx="0.1" ixy="0.0" ixz="0.0"
	      iyy="0.01" iyz="0.0"
	      izz="0.11"/>
        </inertial>
      </link>

      <joint name="joint${self}" type="revolute">
        <limit effort="100.0" lower="-1.57" upper="1.57" velocity="0.5"/>
        <parent link="link${self}"/>
        <child link="joint${self}"/>
        <origin rpy="0 0 0" xyz="-${link_length*.5} 0 0"/>
        <axis xyz="0 0 1"/>
        <dynamics damping="0.8"/>
      </joint>

      <link name="joint${self}">
        <collision>
          <origin rpy="0 0 0" xyz="0 0 0"/>
          <geometry>
            <cylinder length="0.05" radius="0.02"/>
          </geometry>
        </collision>
        <visual>
          <origin rpy="0 0 0" xyz="0 0 0"/>
          <geometry>
            <cylinder length="0.001" radius="0.001"/>
          </geometry>
          <material name="color">
            <color rgba="0.75 .5 .2 1"/>
          </material>
        </visual>
        <inertial>
          <origin rpy="0 0 0" xyz="0 0 0"/>
          <mass value="0.1"/>
          <inertia ixx="0.00005" ixy="0.0" ixz="0.0" iyy="0.00005" iyz="0.0" izz="0.0001"/>
        </inertial>
      </link>

      <joint name="joint${self}_link${child}" type="fixed">
        <parent link="joint${self}"/>
        <child link="link${child}"/>
        <origin rpy="0 0 0" xyz="-${link_length*.5} 0 0"/> 
      </joint>

    </xacro:if>
    <xacro:unless value="${head}">
      <xacro:if value="${tail}">
        <link name="link${self}">
          <collision>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <geometry>
              <cylinder length="${protector_radius}" radius="0.1"/>
            </geometry>
          </collision>

          <visual>
            <origin rpy="0 0 ${pi}" xyz="0 0 0"/>
            <geometry>
              <mesh filename="package://aerial_robot_model/urdf/hydra3/mesh/hydra_link4.stl" scale=".001 .001 .001"/>
            </geometry>
            <xacro:link_color /> 
          </visual>

          <inertial>
            <origin xyz="0 0 0" rpy="0 0 0"/>
            <mass value="0.5"/>
            <inertia
	        ixx="0.1" ixy="0.0" ixz="0.0"
	        iyy="0.01" iyz="0.0"
	        izz="0.11"/>
          </inertial>
        </link>

      </xacro:if>
      <xacro:unless value="${tail}">
        <xacro:if value="${imu}">

          <link name="link${self}">
            <collision>
              <origin xyz="0 0 0" rpy="0 0 0"/>
              <geometry>
                <cylinder length="${protector_radius}" radius="0.1"/>
              </geometry>
            </collision>

            <visual>
              <origin rpy="0 0 ${pi}" xyz="0 0 0"/>
              <geometry>
                <mesh filename="package://aerial_robot_model/urdf/hydra3/mesh/hydra_link2.stl" scale=".001 .001 .001"/>
              </geometry>
              <xacro:link_color /> 
            </visual>

            <inertial>
              <origin xyz="0 0 0" rpy="0 0 0"/>
              <mass value="0.5"/>
              <inertia
	          ixx="0.1" ixy="0.0" ixz="0.0"
	          iyy="0.01" iyz="0.0"
	          izz="0.11"/>
            </inertial>
          </link>

        </xacro:if>
        <xacro:unless value="${imu}">

          <link name="link${self}">
            <collision>
              <origin xyz="0 0 0" rpy="0 0 0"/>
              <geometry>
                <cylinder length="0.1" radius="${protector_radius}"/>
              </geometry>
            </collision>

            <visual>
              <origin rpy="0 0 ${pi}" xyz="0 0 0"/>
              <geometry>
                <mesh filename="package://aerial_robot_model/urdf/hydra3/mesh/hydra_link3.stl" scale=".001 .001 .001"/>
              </geometry>
              <xacro:link_color /> 
            </visual>

            <inertial>
              <origin xyz="0 0 0" rpy="0 0 0"/>
              <mass value="0.5"/>
              <inertia
	          ixx="0.1" ixy="0.0" ixz="0.0"
	          iyy="0.01" iyz="0.0"
	          izz="0.11"/>
            </inertial>
          </link>
          
        </xacro:unless>
        <joint name="joint${self}" type="revolute">
          <limit effort="100.0" lower="-1.57" upper="1.57" velocity="0.5"/>
          <parent link="link${self}"/>
          <child link="joint${self}"/>
          <origin rpy="0 0 0" xyz="-${link_length*.5} 0 0"/>
          <axis xyz="0 0 1"/>
          <dynamics damping="0.7"/>
        </joint>

        <link name="joint${self}"> 
          <collision>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
              <cylinder length="0.05" radius="0.02"/>
            </geometry>
          </collision>
          <visual>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <geometry>
              <cylinder length="0.001" radius="0.001"/>
            </geometry>
            <material name="color">
              <color rgba="0.75 .5 .2 1"/>
            </material>
          </visual>
          <inertial>
            <origin rpy="0 0 0" xyz="0 0 0"/>
            <mass value="0.1"/>
            <inertia ixx="0.00005" ixy="0.0" ixz="0.0" iyy="0.00005" iyz="0.0" izz="0.0001"/>
          </inertial>
        </link>

        <joint name="joint${self}_link${child}" type="fixed">
          <parent link="joint${self}"/>
          <child link="link${child}"/>
          <origin rpy="0 0 0" xyz="-${link_length*.5} 0 0"/> 
        </joint>

      </xacro:unless>


    </xacro:unless>

  </xacro:macro>

</robot>
